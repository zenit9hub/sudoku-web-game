# PRD: 웹 스도쿠 게임
**Product Requirements Document**

---

## 📋 프로젝트 개요

### 프로젝트 명
**Sudoku Web Game** - DDD 아키텍처 기반 확장 가능한 스도쿠 게임

### 프로젝트 목표
- 웹 브라우저에서 실행되는 완전한 스도쿠 게임 구현
- 도메인 주도 설계(DDD) 패턴을 활용한 유지보수 가능한 아키텍처
- 반응형 디자인으로 모바일/데스크톱 모든 기기 지원
- 브라우저 로컬 스토리지 기반 게임 저장/불러오기

### 대상 사용자
- 스도쿠 퍼즐을 즐기는 모든 연령층
- 웹 브라우저가 있는 모든 디바이스 사용자
- 오프라인 환경에서도 게임을 즐기고자 하는 사용자

---

## 🎯 핵심 기능 요구사항

### 1. 게임 플레이 기능

#### 1.1 퍼즐 생성
- **난이도별 퍼즐 생성**: Easy, Medium, Hard, Expert 4단계
- **유니크 솔루션**: 모든 퍼즐은 하나의 유일한 해답을 가짐
- **대칭적 배치**: Easy 모드에서는 미적으로 균형잡힌 퍼즐 생성
- **수학적 확실성**: 백트래킹 알고리즘으로 항상 성공적인 퍼즐 생성 보장

```typescript
// 난이도별 주어진 숫자 개수
EASY: 40-50개 (비교적 쉬움)
MEDIUM: 30-40개 (중간 난이도)
HARD: 25-35개 (어려움)
EXPERT: 20-30개 (매우 어려움)
```

#### 1.2 사용자 입력
- **셀 선택**: 클릭으로 빈 셀 선택
- **숫자 입력**: 1-9 숫자 버튼 또는 키보드 입력
- **숫자 지우기**: 선택된 셀의 숫자 삭제
- **입력 제한**: 주어진 숫자(Given) 셀은 수정 불가

#### 1.3 게임 진행
- **실시간 검증**: 입력 즉시 규칙 위반 여부 확인
- **오류 표시**: 중복된 숫자 입력 시 시각적 피드백
- **완료 감지**: 모든 셀이 올바르게 채워지면 자동 완료 처리
- **통계 추적**: 시간, 이동 횟수, 힌트 사용 횟수, 실수 횟수

### 2. 사용자 인터페이스

#### 2.1 게임 보드
- **9x9 그리드**: HTML5 Canvas 기반 고성능 렌더링
- **3x3 블록 구분**: 시각적으로 명확한 블록 경계선
- **반응형 크기**: 화면 크기에 따른 자동 조절
- **선택 표시**: 선택된 셀과 관련 행/열/블록 하이라이트

#### 2.2 숫자 입력 패드
- **9개 숫자 버튼**: 1-9까지 각각의 전용 버튼
- **스마트 카운팅**: 각 숫자별 남은 입력 가능 개수 표시
- **자동 비활성화**: 9개 모두 사용된 숫자 버튼 자동 disable
- **시각적 피드백**: 버튼 상태에 따른 스타일 변화

```
버튼 레이아웃:
[1] [2] [3] [4] [5] [6] [7] [8] [9]
 8   9   7   9   6   9   9   9   9   ← 남은 개수
```

#### 2.3 게임 정보 표시
- **타이머**: MM:SS 형식의 실시간 경과 시간
- **진행률**: 채워진 셀 수 / 전체 81개 셀
- **힌트 카운터**: 사용한 힌트 개수
- **선택 정보**: 현재 선택된 셀의 좌표와 상태

#### 2.4 게임 컨트롤
- **New Game**: 새로운 퍼즐 시작
- **Reset**: 현재 퍼즐을 초기 상태로 리셋
- **Hint**: 자동으로 하나의 정답 제공
- **Clear**: 선택된 셀의 숫자 삭제

### 3. 데이터 관리

#### 3.1 게임 상태 저장
- **자동 저장**: 모든 게임 액션 후 즉시 로컬 스토리지에 저장
- **게임 복원**: 브라우저 새로고침 후에도 게임 상태 유지
- **다중 게임**: 여러 게임을 동시에 관리 가능
- **상태 직렬화**: JSON 형태로 게임 상태를 안전하게 저장

#### 3.2 통계 데이터
```typescript
interface GameStatistics {
  startTime: Date;        // 게임 시작 시간
  endTime?: Date;         // 게임 완료 시간
  elapsedTime: number;    // 총 소요 시간(초)
  moves: number;          // 총 이동 횟수
  hints: number;          // 사용한 힌트 개수
  mistakes: number;       // 실수 횟수
}
```

---

## 🏗️ 기술 아키텍처

### 아키텍처 패턴
**Domain-Driven Design (DDD)** 기반 계층형 아키텍처

```
src/
├── domain/          # 비즈니스 로직 (순수)
│   ├── models/      # 도메인 엔티티
│   └── services/    # 도메인 서비스
├── application/     # 유스케이스, 애플리케이션 서비스
├── infrastructure/  # 외부 의존성 (Storage, API 등)
└── presentation/    # UI 계층 (Controllers, Managers, Renderers)
```

### 핵심 도메인 모델

#### SudokuGame (게임 집합체)
```typescript
class SudokuGame {
  readonly id: string;              // 게임 고유 ID
  readonly grid: SudokuGrid;        // 현재 그리드 상태
  readonly initialGrid: SudokuGrid; // 초기 퍼즐 상태
  readonly state: GameState;        // 게임 메타데이터
}
```

#### SudokuGrid (9x9 그리드)
```typescript
class SudokuGrid {
  getCell(position: Position): Cell;
  setCell(position: Position, value: CellValue): SudokuGrid;
  getRemainingCounts(): Map<number, number>;  // 숫자별 남은 개수
  isComplete(): boolean;
}
```

#### Cell (개별 셀)
```typescript
class Cell {
  readonly position: Position;      // 셀 위치 (row, col)
  readonly value: CellValue;        // 셀 값 (1-9 또는 empty)
  readonly isGiven: boolean;        // 초기 주어진 숫자 여부
  readonly isHighlighted: boolean;  // 하이라이트 상태
  readonly hasError: boolean;       // 오류 상태
}
```

### 기술 스택
- **Frontend**: TypeScript, HTML5 Canvas, CSS3
- **빌드 도구**: Vite
- **테스팅**: Jest, Jest-DOM
- **코드 품질**: ESLint, TypeScript Compiler
- **번들 사이즈**: 42.10 kB (gzip: 11.77 kB)

---

## 🎮 사용자 여정 (User Journey)

### 신규 게임 시작
1. 사용자가 웹사이트 접속
2. **New Game** 버튼 클릭
3. 자동으로 Easy 난이도 퍼즐 생성
4. 게임 보드와 UI 요소들이 표시됨
5. 타이머 자동 시작

### 게임 플레이
1. 빈 셀 클릭하여 선택
2. 숫자 패드에서 원하는 숫자 클릭
3. 입력 즉시 검증 및 시각적 피드백
4. 남은 숫자 개수가 실시간 업데이트
5. 9개 모두 사용된 숫자는 버튼 비활성화

### 게임 완료
1. 마지막 셀 입력 시 자동 완료 감지
2. 타이머 정지
3. 완료 메시지와 통계 표시
4. 게임 상태를 완료로 변경

---

## ⚙️ 핵심 비즈니스 로직

### 퍼즐 생성 알고리즘
```typescript
class SudokuGeneratorService {
  generatePuzzle(difficulty: Difficulty): SudokuGrid {
    // 1. 랜덤한 첫 번째 행으로 시작 (1-9 랜덤 배치)
    // 2. 백트래킹으로 완전한 9x9 해답 그리드 생성
    // 3. 패턴 변형으로 퍼즐 랜덤화 (숫자 치환, 행/열 교환 등)
    // 4. 난이도에 따라 특정 개수의 숫자 제거
    // 5. 유니크 솔루션 검증 후 완성된 퍼즐 반환
  }
}
```

### 입력 검증 로직
```typescript
class SudokuValidationService {
  validateMove(grid: SudokuGrid, position: Position, value: CellValue): ValidationResult {
    // 1. 같은 행에 중복 숫자 확인
    // 2. 같은 열에 중복 숫자 확인
    // 3. 같은 3x3 블록에 중복 숫자 확인
    // 4. 충돌하는 셀들의 위치 반환
  }
}
```

### 힌트 생성 로직
```typescript
getHint(game: SudokuGame): HintResult | null {
  // 1. 빈 셀 중에서 가능한 숫자가 1개인 셀 우선 검색
  // 2. 없으면 랜덤하게 빈 셀 선택
  // 3. 해당 셀의 가능한 숫자 중 첫 번째 반환
}
```

---

## 🎨 UI/UX 요구사항

### 반응형 디자인
- **모바일 우선**: 320px ~ 450px 폭에서 최적화
- **데스크톱 지원**: 최대 875px 높이까지 확장
- **터치 친화적**: 최소 44px 터치 영역 확보
- **고해상도 대응**: Retina 디스플레이 지원

### 시각적 피드백
- **선택 표시**: 선택된 셀과 관련 행/열/블록 하이라이트
- **오류 표시**: 잘못된 입력 시 빨간색 테두리
- **완료 애니메이션**: 게임 완료 시 축하 메시지
- **버튼 상태**: Hover, Active, Disabled 상태별 스타일

### 성능 요구사항
- **렌더링**: 60fps 유지
- **반응성**: 모든 인터랙션 200ms 이내 반응
- **로딩**: 초기 로딩 3초 이내
- **메모리**: 50MB 이내 메모리 사용량

---

## 🧪 테스트 요구사항

### 단위 테스트
- **도메인 로직**: 핵심 비즈니스 로직 100% 커버리지
- **모델 검증**: 모든 도메인 모델의 불변성 검증
- **서비스 테스트**: 퍼즐 생성, 검증 로직 테스트

### 통합 테스트
- **게임 플로우**: 신규 게임부터 완료까지 전체 플로우
- **상태 관리**: 저장/불러오기 기능 검증
- **UI 인터랙션**: 사용자 입력과 UI 반응 테스트

### 성능 테스트
- **퍼즐 생성 시간**: 백트래킹 알고리즘으로 3초 이내 안정적 생성
- **메모리 누수**: 장시간 플레이 시 메모리 증가 없음
- **캔버스 렌더링**: 부드러운 애니메이션 유지

---

## 🚀 배포 및 운영

### 빌드 프로세스
```bash
npm run build    # TypeScript 컴파일 + Vite 번들링
npm run test     # 전체 테스트 실행
npm run lint     # 코드 품질 검사
```

### 정적 호스팅
- **GitHub Pages, Netlify, Vercel** 등 정적 호스팅 서비스 지원
- **PWA 대응**: 오프라인에서도 실행 가능
- **캐싱 전략**: 브라우저 캐시 최대 활용

### 모니터링
- **에러 트래킹**: 브라우저 콘솔 에러 최소화
- **성능 메트릭**: Core Web Vitals 준수
- **사용성 메트릭**: 게임 완료율, 평균 플레이 시간

---

## 🔮 향후 확장 계획

### Phase 2 기능
- **다양한 퍼즐 크기**: 4x4, 6x6 지원
- **테마 시스템**: 다크 모드, 커스텀 컬러
- **사운드 효과**: 입력음, 완료음 추가
- **애니메이션**: 부드러운 전환 효과

### Phase 3 기능
- **멀티플레이어**: 실시간 대전 모드
- **클라우드 저장**: 계정 기반 진행 상황 동기화
- **리더보드**: 전 세계 랭킹 시스템
- **AI 도우미**: 단계별 해결 가이드

---

## 📊 성공 지표 (KPI)

### 기술 지표
- **번들 크기**: < 50KB (현재: 40.01KB ✅)
- **퍼즐 생성**: < 3초 (백트래킹 알고리즘 최적화)
- **테스트 커버리지**: > 80%
- **타입 안전성**: 100% TypeScript

### 사용자 지표
- **완료율**: 시작한 게임의 30% 이상 완료
- **재방문율**: 7일 내 50% 이상 재방문
- **평균 세션**: 10분 이상
- **오류율**: < 1% 에러 발생

---

## 👥 개발팀 가이드

### 코드 컨벤션
- **아키텍처**: DDD 패턴 엄격 준수
- **네이밍**: PascalCase(클래스), camelCase(메소드/변수)
- **타입 안전성**: any 타입 사용 금지
- **불변성**: 모든 도메인 객체는 immutable

### 개발 워크플로우
1. **기능 개발**: 도메인 로직부터 구현
2. **테스트 작성**: TDD 방식 권장
3. **UI 구현**: 마지막에 프레젠테이션 계층
4. **통합 테스트**: 전체 플로우 검증

### 성능 최적화
- **번들 사이즈**: 불필요한 의존성 제거
- **렌더링**: requestAnimationFrame 활용
- **메모리**: 이벤트 리스너 정리
- **캐싱**: 계산 결과 메모이제이션

---

*이 문서는 현재 구현된 스도쿠 게임의 모든 기능과 요구사항을 담고 있으며, 주니어 개발자도 쉽게 이해하고 기여할 수 있도록 작성되었습니다.*
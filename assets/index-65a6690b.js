(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();const ue="modulepreload",de=function(o){return"/sudoku-web-game/"+o},K={},k=function(e,t,s){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(n=>{if(n=de(n),n in K)return;K[n]=!0;const r=n.endsWith(".css"),l=r?'[rel="stylesheet"]':"";if(!!s)for(let u=i.length-1;u>=0;u--){const d=i[u];if(d.href===n&&(!r||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${l}`))return;const c=document.createElement("link");if(c.rel=r?"stylesheet":ue,r||(c.as="script",c.crossOrigin=""),c.href=n,document.head.appendChild(c),r)return new Promise((u,d)=>{c.addEventListener("load",u),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e()).catch(n=>{const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=n,window.dispatchEvent(r),!r.defaultPrevented)throw n})};var Q=(o=>(o.INITIAL="initial",o.IN_PROGRESS="in_progress",o.COMPLETED="completed",o.PAUSED="paused",o))(Q||{}),C=(o=>(o.EASY="easy",o.MEDIUM="medium",o.HARD="hard",o.EXPERT="expert",o))(C||{});class p{constructor(e,t,s,i,n){this.id=e,this.difficulty=t,this.status=s,this.statistics=i,this.selectedCell=n}get moveCount(){return this.statistics.moves}get mistakeCount(){return this.statistics.mistakes}get elapsedTime(){return this.statistics.elapsedTime}get isComplete(){return this.status==="completed"}get isPaused(){return this.status==="paused"}get gameId(){return this.id}get hintsUsed(){return this.statistics.hints}get startTime(){return this.statistics.startTime.getTime()}static create(e,t){return new p(e,t,"initial",{startTime:new Date,elapsedTime:0,moves:0,hints:0,mistakes:0})}static createNew(e){return new p("",e||"medium","initial",{startTime:new Date,elapsedTime:0,moves:0,hints:0,mistakes:0})}start(){return new p(this.id,this.difficulty,"in_progress",{...this.statistics,startTime:new Date},this.selectedCell)}complete(){return new p(this.id,this.difficulty,"completed",{...this.statistics,endTime:new Date},this.selectedCell)}pause(){return new p(this.id,this.difficulty,"paused",this.statistics,this.selectedCell)}resume(){return new p(this.id,this.difficulty,"in_progress",this.statistics,this.selectedCell)}addMove(){return new p(this.id,this.difficulty,this.status,{...this.statistics,moves:this.statistics.moves+1},this.selectedCell)}addHint(){return new p(this.id,this.difficulty,this.status,{...this.statistics,hints:this.statistics.hints+1},this.selectedCell)}addMistake(){return new p(this.id,this.difficulty,this.status,{...this.statistics,mistakes:this.statistics.mistakes+1},this.selectedCell)}selectCell(e,t){return new p(this.id,this.difficulty,this.status,this.statistics,{row:e,col:t})}clearSelection(){return new p(this.id,this.difficulty,this.status,this.statistics,void 0)}}const ee=Object.freeze(Object.defineProperty({__proto__:null,Difficulty:C,GameState:p,GameStatus:Q},Symbol.toStringTag,{value:"Module"}));class R{constructor(e,t,s,i,n,r){this.id=e,this._grid=t,this._initialGrid=s,this._state=i,this.createdAt=n||new Date,this.updatedAt=r||new Date}static create(e,t,s){const i=s||p.createNew();return new R(e,t,t.clone(),i)}get grid(){return this._grid}get initialGrid(){return this._initialGrid}get state(){return this._state}updateGrid(e){return new R(this.id,e,this._initialGrid,this._state,this.createdAt,new Date)}updateState(e){return new R(this.id,this._grid,this._initialGrid,e,this.createdAt,new Date)}reset(){return new R(this.id,this._initialGrid.clone(),this._initialGrid,p.create(this.id,this._state.difficulty),this.createdAt,new Date)}clone(){return new R(this.id,this._grid.clone(),this._initialGrid.clone(),this._state,this.createdAt,this.updatedAt)}}const te=class x{constructor(e){this.value=e,this.validateValue(e)}validateValue(e){if(e!==null&&!x.VALID_VALUES.has(e))throw new Error(`Invalid cell value: ${e}. Must be between 1 and 9 or null.`)}static empty(){return new x(null)}static from(e){return new x(e)}isEmpty(){return this.value===null}equals(e){return this.value===e.value}toString(){var e;return((e=this.value)==null?void 0:e.toString())??""}toNumber(){if(this.value===null)throw new Error("Cannot convert empty cell value to number");return this.value}isValid(){return this.value===null||x.VALID_VALUES.has(this.value)}};te.VALID_VALUES=new Set([1,2,3,4,5,6,7,8,9]);let w=te;class y{constructor(e,t=w.empty(),s={}){this.position=e,this._value=t,this._options=s}get value(){return this._value}get isGiven(){return this._options.isGiven??!1}get isHighlighted(){return this._options.isHighlighted??!1}get hasError(){return this._options.hasError??!1}setValue(e){if(this.isGiven)throw new Error(`Cannot modify given cell at ${this.position.toString()}`);return new y(this.position,e,this._options)}setHighlight(e){return new y(this.position,this._value,{...this._options,isHighlighted:e})}setError(e){return new y(this.position,this._value,{...this._options,hasError:e})}isEmpty(){return this._value.isEmpty()}equals(e){return this.position.equals(e.position)&&this._value.equals(e._value)}}class h{constructor(e,t){this.row=e,this.col=t,this.validatePosition(e,t)}validatePosition(e,t){if(e<0||e>8||t<0||t>8)throw new Error(`Invalid position: (${e}, ${t}). Must be between 0 and 8.`)}equals(e){return this.row===e.row&&this.col===e.col}toString(){return`(${this.row}, ${this.col})`}getBoxIndex(){return Math.floor(this.row/3)*3+Math.floor(this.col/3)}isValid(){return this.row>=0&&this.row<=8&&this.col>=0&&this.col<=8}}const se=class A{constructor(e){e?(this.validateGridSize(e),this.cells=e.map(t=>[...t])):this.cells=this.createEmptyGrid()}validateGridSize(e){if(e.length!==A.GRID_SIZE||e.some(t=>t.length!==A.GRID_SIZE))throw new Error("Grid must be 9x9")}createEmptyGrid(){return Array.from({length:A.GRID_SIZE},(e,t)=>Array.from({length:A.GRID_SIZE},(s,i)=>new y(new h(t,i))))}getCell(e){return this.cells[e.row][e.col]}setCell(e,t){const s=this.cells.map(i=>[...i]);return s[e.row][e.col]=this.getCell(e).setValue(t),new A(s)}getRow(e){return[...this.cells[e]]}getColumn(e){return this.cells.map(t=>t[e])}getBox(e){const t=Math.floor(e/3)*3,s=e%3*3,i=[];for(let n=t;n<t+3;n++)for(let r=s;r<s+3;r++)i.push(this.cells[n][r]);return i}getAllCells(){return this.cells.flat()}clone(){return new A(this.cells)}isEmpty(){return this.getAllCells().every(e=>e.isEmpty())}isFull(){return this.getAllCells().every(e=>!e.isEmpty())}getEmptyCells(){return this.getAllCells().filter(e=>e.isEmpty()&&!e.isGiven)}getGivenCells(){return this.getAllCells().filter(e=>e.isGiven)}getFilledCells(){return this.getAllCells().filter(e=>!e.isEmpty())}getFilledCellCount(){return this.getFilledCells().length}getNumberCounts(){const e=new Map;for(let t=1;t<=9;t++)e.set(t,0);return this.getAllCells().forEach(t=>{if(!t.isEmpty()){const s=t.value.toNumber();e.set(s,(e.get(s)||0)+1)}}),e}getRemainingCounts(){const e=this.getNumberCounts(),t=new Map;for(let s=1;s<=9;s++){const i=e.get(s)||0;t.set(s,Math.max(0,9-i))}return t}};se.GRID_SIZE=9;let N=se;class ie{validateMove(e,t,s){if(s.isEmpty())return{isValid:!0,conflictingPositions:[]};const i=this.findConflicts(e,t,s);return{isValid:i.length===0,conflictingPositions:i}}findConflicts(e,t,s){const i=[];return i.push(...this.findRowConflicts(e,t,s)),i.push(...this.findColumnConflicts(e,t,s)),i.push(...this.findBoxConflicts(e,t,s)),i}findRowConflicts(e,t,s){const i=[];return e.getRow(t.row).forEach(r=>{!r.position.equals(t)&&r.value.equals(s)&&!r.value.isEmpty()&&i.push(r.position)}),i}findColumnConflicts(e,t,s){const i=[];return e.getColumn(t.col).forEach(r=>{!r.position.equals(t)&&r.value.equals(s)&&!r.value.isEmpty()&&i.push(r.position)}),i}findBoxConflicts(e,t,s){const i=[],n=t.getBoxIndex();return e.getBox(n).forEach(l=>{!l.position.equals(t)&&l.value.equals(s)&&!l.value.isEmpty()&&i.push(l.position)}),i}isGridComplete(e){return e.isFull()?e.getAllCells().every(t=>t.isEmpty()?!1:this.validateMove(e,t.position,t.value).isValid):!1}getPossibleValues(e,t){const s=[];for(let i=1;i<=9;i++){const n=w.from(i);this.validateMove(e,t,n).isValid&&s.push(n)}return s}}class me{constructor(e){this.validationService=new ie,e!==void 0?this.random=this.createSeededRandom(e):this.random=Math.random}generatePuzzle(e,t={}){const s=this.generateCompleteSolution(),i=this.substituteNumbers(s);return this.removeCells(i,e,t.useSymmetricRemoval)}generateCompleteSolution(){const e=new N,t=this.shuffleArray([1,2,3,4,5,6,7,8,9]);for(let i=0;i<9;i++){const n=new h(0,i),r=w.from(t[i]),l=new y(n,r,{isGiven:!1}),a=this.getGridCells(e);a[0][i]=l;const c=new N(a);if(!this.validationService.validateMove(c,n,r).isValid)throw new Error("Invalid first row generation")}const s=this.setFirstRow(e,t);return this.solveWithBacktracking(s)||e}solveWithBacktracking(e){const t=this.getEmptyCells(e);if(t.length===0)return e;const s=t[0],i=this.validationService.getPossibleValues(e,s),n=this.shuffleArray(i);for(const r of n){const l=e.setCell(s,r);if(this.validationService.validateMove(l,s,r).isValid){const a=this.solveWithBacktracking(l);if(a)return a}}return null}removeCells(e,t,s=!1){const i=this.getCellsToRemove(t),n=this.getAllPositions(),r=this.shuffleArray(n);let l=e,a=0;for(const c of r){if(a>=i)break;l.getCell(c).isEmpty()||(l=l.setCell(c,w.empty()),a++)}return this.markGivenCells(l)}getCellsToRemove(e){switch(e){case C.EASY:return 38;case C.MEDIUM:return 44;case C.HARD:return 50;case C.EXPERT:return 57;default:return 44}}shuffleArray(e){const t=[...e];for(let s=t.length-1;s>0;s--){const i=Math.floor(this.random()*(s+1));[t[s],t[i]]=[t[i],t[s]]}return t}createSeededRandom(e){let t=e;return()=>(t=(t*1664525+1013904223)%4294967296,t/4294967296)}getEmptyCells(e){const t=[];for(let s=0;s<9;s++)for(let i=0;i<9;i++){const n=new h(s,i);e.getCell(n).isEmpty()&&t.push(n)}return t}getAllPositions(){const e=[];for(let t=0;t<9;t++)for(let s=0;s<9;s++)e.push(new h(t,s));return e}getGridCells(e){const t=[];for(let s=0;s<9;s++){t[s]=[];for(let i=0;i<9;i++)t[s][i]=e.getCell(new h(s,i))}return t}setFirstRow(e,t){const s=this.getGridCells(e);for(let i=0;i<9;i++){const n=new h(0,i),r=w.from(t[i]);s[0][i]=new y(n,r,{isGiven:!1})}return new N(s)}markGivenCells(e){const t=this.getGridCells(e);for(let s=0;s<9;s++)for(let i=0;i<9;i++){const n=t[s][i];n.isEmpty()||(t[s][i]=new y(n.position,n.value,{isGiven:!0}))}return new N(t)}substituteNumbers(e){const t=this.generateNumberSubstitution(),s=this.getGridCells(e);for(let i=0;i<9;i++)for(let n=0;n<9;n++){const r=s[i][n];if(!r.isEmpty()){const l=w.from(t[r.value.value]);s[i][n]=new y(r.position,l,{isGiven:!1})}}return new N(s)}generateNumberSubstitution(){const e=[1,2,3,4,5,6,7,8,9],t=this.shuffleArray(e),s={};for(let i=0;i<9;i++)s[e[i]]=t[i];return s}}var M=(o=>(o.ROW_COMPLETION="ROW_COMPLETION",o.COLUMN_COMPLETION="COLUMN_COMPLETION",o))(M||{}),E=(o=>(o.LINEAR="LINEAR",o.RADIAL="RADIAL",o))(E||{}),v=(o=>(o.PENDING="PENDING",o.PLAYING="PLAYING",o.COMPLETED="COMPLETED",o))(v||{});const X=class D{constructor(e,t,s,i,n,r,l,a=[],c){this.id=e,this.type=t,this.animation=s,this.lineIndex=i,this.cellPositions=n,this.state=r,this.startTime=l,this.cellEffects=a,this.completionPosition=c}createCellEffects(e){return this.cellPositions.map((t,s)=>({position:t,startTime:this.calculateCellStartTime(s,e),stepIndex:0,isActive:!1,isCompleted:!1}))}updateProgress(e){if(this.state!==v.PLAYING)return this;const t=this.cellEffects.map(r=>{if(r.isCompleted)return r;const l=e-r.startTime;if(l<0)return r;if(!r.isActive)return{...r,isActive:!0,stepIndex:0};const a=Math.floor(l/D.STEP_INTERVAL);return a>=D.EFFECT_STEPS?{...r,stepIndex:D.EFFECT_STEPS-1,isCompleted:!0}:{...r,stepIndex:Math.max(0,a)}}),i=t.every(r=>r.isCompleted)?v.COMPLETED:v.PLAYING,n=this.constructor;return new n(this.id,this.type,this.animation,this.lineIndex,this.cellPositions,i,this.startTime,t,this.completionPosition)}getActiveCellEffects(){return this.cellEffects.filter(e=>e.isActive&&!e.isCompleted)}getCellEffectProgress(e){const t=this.cellEffects.find(r=>r.position.equals(e));if(!t||!t.isActive||t.isCompleted)return null;const s=t.stepIndex/(D.EFFECT_STEPS-1),i=1+s*.5,n=1-s;return{scale:i,opacity:n}}isCompleted(){return this.state===v.COMPLETED}isPlaying(){return this.state===v.PLAYING}getCurrentlyAnimatingPositions(){return this.getActiveCellEffects().map(e=>e.position)}};X.EFFECT_STEPS=15;X.STEP_INTERVAL=35;let ne=X;const re=class _ extends ne{static createRowEffect(e,t){const s=[];for(let i=0;i<9;i++)s.push(new h(t,i));return new _(e,M.ROW_COMPLETION,E.LINEAR,t,s,v.PENDING,Date.now(),[])}static createColumnEffect(e,t){const s=[];for(let i=0;i<9;i++)s.push(new h(i,t));return new _(e,M.COLUMN_COMPLETION,E.LINEAR,t,s,v.PENDING,Date.now(),[])}start(){const e=Date.now(),t=this.createCellEffects(e);return new _(this.id,this.type,this.animation,this.lineIndex,this.cellPositions,v.PLAYING,e,t,this.completionPosition)}calculateCellStartTime(e,t){return t+e*_.CELL_DELAY}};re.CELL_DELAY=35;let Z=re;const le=class L extends ne{static createRowEffect(e,t,s){const i=[];for(let n=0;n<9;n++)i.push(new h(t,n));return new L(e,M.ROW_COMPLETION,E.RADIAL,t,i,v.PENDING,Date.now(),[],s)}static createColumnEffect(e,t,s){const i=[];for(let n=0;n<9;n++)i.push(new h(n,t));return new L(e,M.COLUMN_COMPLETION,E.RADIAL,t,i,v.PENDING,Date.now(),[],s)}start(){const e=Date.now(),t=this.createCellEffects(e);return new L(this.id,this.type,this.animation,this.lineIndex,this.cellPositions,v.PLAYING,e,t,this.completionPosition)}calculateCellStartTime(e,t){if(!this.completionPosition)return t+e*L.CELL_DELAY;const s=this.cellPositions[e];let i;this.type===M.ROW_COMPLETION?i=Math.abs(s.col-this.completionPosition.col):i=Math.abs(s.row-this.completionPosition.row);const n=Math.random()*5;return t+i*L.CELL_DELAY+n}getCellsByDistance(){if(!this.completionPosition)return new Map;const e=new Map;return this.cellPositions.forEach(t=>{let s;this.type===M.ROW_COMPLETION?s=Math.abs(t.col-this.completionPosition.col):s=Math.abs(t.row-this.completionPosition.row),e.has(s)||e.set(s,[]),e.get(s).push(t)}),e}};le.CELL_DELAY=35;let j=le;class ${constructor(e){if(this.value=e,!e||e.trim().length===0)throw new Error("EffectSequenceId cannot be empty")}static generate(){const e=Date.now(),t=Math.random().toString(36).substr(2,9);return new $(`sequence_${e}_${t}`)}static fromString(e){return new $(e)}toString(){return this.value}equals(e){return this.value===e.value}}var m=(o=>(o.PENDING="PENDING",o.RUNNING="RUNNING",o.PAUSED="PAUSED",o.COMPLETED="COMPLETED",o.CANCELLED="CANCELLED",o))(m||{});class fe{constructor(e,t){this.aggregateId=e,this.eventType=t,this.version=1,this.eventId=`${t}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,this.occurredAt=new Date}}class ge extends fe{constructor(e,t){super(e.toString(),"EffectSequenceStarted"),this.sequenceId=e,this.effectCount=t}}class g{constructor(e,t=m.PENDING,s={},i=[],n,r=0,l=0){this.id=e,this.state=t,this.options=s,this.effects=[],this.currentEffectIndex=0,this.completedCount=0,this.domainEvents=[],this.effects=[...i],this.startTime=n,this.currentEffectIndex=r,this.completedCount=l}static create(e,t={}){if(e.length===0)throw new Error("EffectSequence must contain at least one effect");const s=$.generate(),i={allowConcurrent:!1,autoStart:!0,repeatCount:1,delayBetweenEffects:0,...t};return new g(s,m.PENDING,i,e)}addEffect(e){if(this.state===m.RUNNING)throw new Error("Cannot add effects to a running sequence");const t=[...this.effects,e];return new g(this.id,this.state,this.options,t,this.startTime,this.currentEffectIndex,this.completedCount)}start(){if(this.state===m.RUNNING)return this;if(this.effects.length===0)throw new Error("Cannot start sequence with no effects");const e=Date.now(),t=new g(this.id,m.RUNNING,this.options,this.effects.map((s,i)=>i===0?s.start():s),e,0,this.completedCount);return t.addDomainEvent(new ge(this.id,this.effects.length)),t}pause(){return this.state!==m.RUNNING?this:new g(this.id,m.PAUSED,this.options,this.effects,this.startTime,this.currentEffectIndex,this.completedCount)}resume(){return this.state!==m.PAUSED?this:new g(this.id,m.RUNNING,this.options,this.effects,this.startTime,this.currentEffectIndex,this.completedCount)}cancel(){return this.state===m.COMPLETED||this.state===m.CANCELLED?this:new g(this.id,m.CANCELLED,this.options,this.effects,this.startTime,this.currentEffectIndex,this.completedCount)}update(e){return this.state!==m.RUNNING?this:this.options.allowConcurrent?this.updateConcurrentEffects(e):this.updateSequentialEffects(e)}updateConcurrentEffects(e){const t=this.effects.map(i=>i.isPlaying()?i.updateProgress(e):i);return t.every(i=>i.isCompleted())?this.handleSequenceCompletion(t):new g(this.id,this.state,this.options,t,this.startTime,this.currentEffectIndex,this.completedCount)}updateSequentialEffects(e){if(this.currentEffectIndex>=this.effects.length)return this.handleSequenceCompletion(this.effects);const s=this.effects[this.currentEffectIndex].updateProgress(e),i=this.effects.map((n,r)=>r===this.currentEffectIndex?s:n);if(s.isCompleted()){const n=this.currentEffectIndex+1;if(n<this.effects.length){if(this.shouldStartNextEffect(e)){const l=this.effects[n].start();return i[n]=l,new g(this.id,this.state,this.options,i,this.startTime,n,this.completedCount)}}else return this.handleSequenceCompletion(i)}return new g(this.id,this.state,this.options,i,this.startTime,this.currentEffectIndex,this.completedCount)}shouldStartNextEffect(e){return!this.options.delayBetweenEffects||this.options.delayBetweenEffects<=0?!0:!!this.effects[this.currentEffectIndex].isCompleted()}handleSequenceCompletion(e){const t=this.completedCount+1,s=this.options.repeatCount||1;if(s===0||t<s){const i=e.map(n=>n);return new g(this.id,m.PENDING,this.options,i,void 0,0,t)}return new g(this.id,m.COMPLETED,this.options,e,this.startTime,this.currentEffectIndex,t)}getEffects(){return this.effects}getCurrentEffect(){return this.effects[this.currentEffectIndex]}getActiveEffects(){if(this.options.allowConcurrent)return this.effects.filter(t=>t.isPlaying());const e=this.getCurrentEffect();return e&&e.isPlaying()?[e]:[]}getProgress(){return this.effects.length===0?1:this.options.allowConcurrent?this.effects.filter(t=>t.isCompleted()).length/this.effects.length:this.currentEffectIndex/this.effects.length}isRunning(){return this.state===m.RUNNING}isCompleted(){return this.state===m.COMPLETED}isCancelled(){return this.state===m.CANCELLED}isPaused(){return this.state===m.PAUSED}getDomainEvents(){return[...this.domainEvents]}clearDomainEvents(){return new g(this.id,this.state,this.options,this.effects,this.startTime,this.currentEffectIndex,this.completedCount)}addDomainEvent(e){this.domainEvents.push(e)}}class H{static generateId(){return`effect_${Date.now()}_${++this.effectIdCounter}`}static createRowEffect(e,t=E.LINEAR,s){const i=this.generateId();switch(t){case E.LINEAR:return Z.createRowEffect(i,e);case E.RADIAL:if(!s)throw new Error("RadialEffect requires completion position");return j.createRowEffect(i,e,s);default:throw new Error(`Unsupported animation type: ${t}`)}}static createColumnEffect(e,t=E.LINEAR,s){const i=this.generateId();switch(t){case E.LINEAR:return Z.createColumnEffect(i,e);case E.RADIAL:if(!s)throw new Error("RadialEffect requires completion position");return j.createColumnEffect(i,e,s);default:throw new Error(`Unsupported animation type: ${t}`)}}static createSimpleSequence(e,t){return g.create(e,t)}static createConcurrentSequence(e,t){return g.create(e,{...t,allowConcurrent:!0})}static createDelayedSequence(e,t,s){return g.create(e,{...s,delayBetweenEffects:t})}static createRepeatingSequence(e,t,s){return g.create(e,{...s,repeatCount:t})}static createMultiLineCompletionSequence(e,t=E.RADIAL,s){const i=e.map(n=>n.type==="row"?this.createRowEffect(n.index,t,n.position):this.createColumnEffect(n.index,t,n.position));return this.createSimpleSequence(i,{allowConcurrent:!0,delayBetweenEffects:100,...s})}static createCascadingEffectSequence(e,t=E.RADIAL,s=200){const i=e.map(n=>n.type==="row"?this.createRowEffect(n.index,t,n.position):this.createColumnEffect(n.index,t,n.position));return this.createDelayedSequence(i,s,{allowConcurrent:!1})}static createLineCompletionSequence(e,t,s,i,n){const r=i||E.RADIAL,l=e==="row"?this.createRowEffect(t,r,s):this.createColumnEffect(t,r,s);return this.createSimpleSequence([l],n)}}H.effectIdCounter=0;class pe{detectCompletions(e,t){const s=[];if(t)this.isRowComplete(e,t.row)&&s.push({type:"ROW_COMPLETED",lineIndex:t.row,positions:this.getRowPositions(t.row),completionPosition:t}),this.isColumnComplete(e,t.col)&&s.push({type:"COLUMN_COMPLETED",lineIndex:t.col,positions:this.getColumnPositions(t.col),completionPosition:t});else for(let i=0;i<9;i++)this.isRowComplete(e,i)&&s.push({type:"ROW_COMPLETED",lineIndex:i,positions:this.getRowPositions(i)}),this.isColumnComplete(e,i)&&s.push({type:"COLUMN_COMPLETED",lineIndex:i,positions:this.getColumnPositions(i)});return s}createEffectsFromCompletions(e,t=E.LINEAR){return e.map(s=>s.type==="ROW_COMPLETED"?H.createRowEffect(s.lineIndex,t,s.completionPosition):H.createColumnEffect(s.lineIndex,t,s.completionPosition))}isRowComplete(e,t){const s=e.getRow(t);return s.every(n=>!n.isEmpty())?new Set(s.map(n=>n.value.value)).size===9:!1}isColumnComplete(e,t){const s=e.getColumn(t);return s.every(n=>!n.isEmpty())?new Set(s.map(n=>n.value.value)).size===9:!1}getRowPositions(e){const t=[];for(let s=0;s<9;s++)t.push(new h(e,s));return t}getColumnPositions(e){const t=[];for(let s=0;s<9;s++)t.push(new h(s,e));return t}}class b{constructor(e,t,s,i={}){this.eventType=e,this.aggregateId=t,this.aggregateType=s,this.data=i,this.version=1,this.eventId=this.generateEventId(),this.occurredOn=new Date}generateEventId(){return`${this.eventType}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}class Ee extends b{constructor(e,t,s){super("GameStarted",e,"SudokuGame",{difficulty:t,...s})}}class we extends b{constructor(e,t,s,i,n=[]){super("MoveAttempted",e,"SudokuGame",{position:{row:t.row,col:t.col},value:s.value,isValid:i,conflictingPositions:n.map(r=>({row:r.row,col:r.col}))})}}class Ce extends b{constructor(e,t,s,i){super("ValidMoveCompleted",e,"SudokuGame",{position:{row:t.row,col:t.col},value:s.value,moveCount:i})}}class ve extends b{constructor(e,t,s,i,n){super("InvalidMoveAttempted",e,"SudokuGame",{position:{row:t.row,col:t.col},value:s.value,conflictingPositions:i.map(r=>({row:r.row,col:r.col})),mistakeCount:n})}}class Se extends b{constructor(e,t,s){super("GameCompleted",e,"SudokuGame",{difficulty:t,...s,completedAt:new Date().toISOString()})}}class ye extends b{constructor(e,t){super("GamePaused",e,"SudokuGame",{...t,pausedAt:new Date().toISOString()})}}class Ie extends b{constructor(e,t){super("GameResumed",e,"SudokuGame",{...t,resumedAt:new Date().toISOString()})}}class J extends b{constructor(e,t,s,i){super("HintRequested",e,"SudokuGame",{position:{row:t.row,col:t.col},suggestedValue:s.value,...i})}}class Ge extends b{constructor(e,t){super("GameReset",e,"SudokuGame",{...t,resetAt:new Date().toISOString()})}}class q{constructor(){this.rules=[]}addRule(e){this.rules.push(e),this.sortRulesByPriority()}addRules(e){this.rules.push(...e),this.sortRulesByPriority()}removeRule(e){this.rules=this.rules.filter(t=>t.name!==e)}validate(e){const t=[];for(const s of this.rules)s.isSatisfiedBy(e)||t.push({rule:s,errorMessage:s.getErrorMessage(e),severity:"error"});return{isValid:t.length===0,violatedRules:t,context:e}}validateRule(e,t){const s=this.rules.find(n=>n.name===e);if(!s)throw new Error(`Rule '${e}' not found`);const i=[];return s.isSatisfiedBy(t)||i.push({rule:s,errorMessage:s.getErrorMessage(t),severity:"error"}),{isValid:i.length===0,violatedRules:i,context:t}}validateIf(e,t){const s=this.rules.filter(e),i=[];for(const n of s)n.isSatisfiedBy(t)||i.push({rule:n,errorMessage:n.getErrorMessage(t),severity:"error"});return{isValid:i.length===0,violatedRules:i,context:t}}getRules(){return[...this.rules]}getRuleCount(){return this.rules.length}clearRules(){this.rules=[]}sortRulesByPriority(){this.rules.sort((e,t)=>t.priority-e.priority)}}class I{constructor(e,t,s=0){this.name=e,this.description=t,this.priority=s}}class oe extends I{constructor(){super("CannotModifyGivenCell","Given cells cannot be modified",100)}isSatisfiedBy(e){return!e.grid.getCell(e.position).isGiven}getErrorMessage(e){return`Cannot modify given cell at (${e.position.row}, ${e.position.col})`}}class O extends I{constructor(){super("UniqueInRow","Numbers must be unique within each row",90)}isSatisfiedBy(e){if(e.value.isEmpty())return!0;for(let t=0;t<9;t++){if(t===e.position.col)continue;const s=e.grid.getCell(new h(e.position.row,t));if(!s.isEmpty()&&s.value.equals(e.value))return!1}return!0}getErrorMessage(e){return`Number ${e.value.value} already exists in row ${e.position.row+1}`}}class z extends I{constructor(){super("UniqueInColumn","Numbers must be unique within each column",90)}isSatisfiedBy(e){if(e.value.isEmpty())return!0;for(let t=0;t<9;t++){if(t===e.position.row)continue;const s=e.grid.getCell(new h(t,e.position.col));if(!s.isEmpty()&&s.value.equals(e.value))return!1}return!0}getErrorMessage(e){return`Number ${e.value.value} already exists in column ${e.position.col+1}`}}class B extends I{constructor(){super("UniqueInBox","Numbers must be unique within each 3x3 box",90)}isSatisfiedBy(e){if(e.value.isEmpty())return!0;const t=Math.floor(e.position.row/3)*3,s=Math.floor(e.position.col/3)*3;for(let i=t;i<t+3;i++)for(let n=s;n<s+3;n++){if(i===e.position.row&&n===e.position.col)continue;const r=e.grid.getCell(new h(i,n));if(!r.isEmpty()&&r.value.equals(e.value))return!1}return!0}getErrorMessage(e){const t=Math.floor(e.position.row/3)+1,s=Math.floor(e.position.col/3)+1;return`Number ${e.value.value} already exists in box (${t}, ${s})`}}class ae extends I{constructor(){super("ValidCellValue","Cell value must be between 1-9 or empty",80)}isSatisfiedBy(e){return e.value.isValid()}getErrorMessage(e){return`Invalid cell value: ${e.value.value}. Must be between 1-9 or empty.`}}class ce extends I{constructor(){super("ValidPosition","Position must be within grid bounds",70)}isSatisfiedBy(e){return e.position.isValid()}getErrorMessage(e){return`Invalid position: (${e.position.row}, ${e.position.col}). Must be within 0-8 range.`}}class he extends I{constructor(){super("GameInProgress","Game must be in progress to make moves",60)}isSatisfiedBy(e){return!e.gameState.isComplete&&!e.gameState.isPaused}getErrorMessage(e){return e.gameState.isComplete?"Cannot make moves in completed game":e.gameState.isPaused?"Cannot make moves while game is paused":"Game is not in progress"}}class V extends I{constructor(e=3){super("MaxMistakes",`Maximum ${e} mistakes allowed`,50),this.maxMistakes=e}isSatisfiedBy(e){return e.gameState.mistakeCount<this.maxMistakes}getErrorMessage(e){return`Maximum mistakes (${this.maxMistakes}) reached. Game over.`}}class Y{static createMoveValidationEngine(){const e=new q;return e.addRules([new ce,new ae,new oe,new he,new O,new z,new B]),e}static createDifficultySpecificEngine(e){const t=this.createMoveValidationEngine();switch(e){case C.EASY:break;case C.MEDIUM:t.addRule(new V(5));break;case C.HARD:t.addRule(new V(3));break;case C.EXPERT:t.addRule(new V(1));break}return t}static createGameStateEngine(){return new q}}class be extends I{constructor(){super("NakedSingle","If a cell has only one possible value, it must be that value",40)}isSatisfiedBy(e){if(e.value.isEmpty())return!0;const t=this.getPossibleValues(e.grid,e.position);return t.length===1&&t[0]===e.value.value}getErrorMessage(e){const t=this.getPossibleValues(e.grid,e.position);return t.length===1?`Cell must contain ${t[0]} (naked single)`:"Invalid move for naked single constraint"}getPossibleValues(e,t){const s=[];for(let i=1;i<=9;i++){const n=new w(i),r={grid:e,position:t,value:n,gameState:null},l=new O,a=new z,c=new B;l.isSatisfiedBy(r)&&a.isSatisfiedBy(r)&&c.isSatisfiedBy(r)&&s.push(i)}return s}}class Re extends I{constructor(){super("HiddenSingle","If a value can only go in one cell in a unit, it must go there",30)}isSatisfiedBy(e){return e.value.isEmpty()?!0:this.isHiddenSingleInRow(e)||this.isHiddenSingleInColumn(e)||this.isHiddenSingleInBox(e)}getErrorMessage(e){return`Value ${e.value.value} must be placed at this position (hidden single)`}isHiddenSingleInRow(e){let t=0;for(let s=0;s<9;s++){const i=new h(e.position.row,s);if(e.grid.getCell(i).isEmpty()){const r={...e,position:i},l=new z,a=new B;l.isSatisfiedBy(r)&&a.isSatisfiedBy(r)&&t++}}return t===1}isHiddenSingleInColumn(e){let t=0;for(let s=0;s<9;s++){const i=new h(s,e.position.col);if(e.grid.getCell(i).isEmpty()){const r={...e,position:i},l=new O,a=new B;l.isSatisfiedBy(r)&&a.isSatisfiedBy(r)&&t++}}return t===1}isHiddenSingleInBox(e){let t=0;const s=Math.floor(e.position.row/3)*3,i=Math.floor(e.position.col/3)*3;for(let n=s;n<s+3;n++)for(let r=i;r<i+3;r++){const l=new h(n,r);if(e.grid.getCell(l).isEmpty()){const c={...e,position:l},u=new O,d=new z;u.isSatisfiedBy(c)&&d.isSatisfiedBy(c)&&t++}}return t===1}}const F=Object.freeze(Object.defineProperty({__proto__:null,CannotModifyGivenCellRule:oe,GameInProgressRule:he,HiddenSingleRule:Re,MaxMistakesRule:V,NakedSingleRule:be,SudokuRuleFactory:Y,UniqueInBoxRule:B,UniqueInColumnRule:z,UniqueInRowRule:O,ValidCellValueRule:ae,ValidPositionRule:ce},Symbol.toStringTag,{value:"Module"}));class Te{constructor(e=C.MEDIUM,t){this.moveValidationEngine=Y.createDifficultySpecificEngine(e),this.eventPublisher=t}async validateMove(e,t,s,i){const n={grid:e,position:t,value:s,gameState:i||{isComplete:!1,isPaused:!1,mistakeCount:0}},r=this.moveValidationEngine.validate(n),l=this.getConflictingPositions(e,t,s),a=await this.generateSuggestions(e,t,s),c={isValid:r.isValid,conflictingPositions:l,errorMessages:r.violatedRules.map(u=>u.errorMessage),violatedRules:r.violatedRules.map(u=>u.rule.name),suggestions:r.isValid?void 0:a};if(this.eventPublisher&&i){const u=i.id||"unknown";await this.eventPublisher.publish(new we(u,t,s,r.isValid,l)),r.isValid?await this.eventPublisher.publish(new Ce(u,t,s,i.moveCount+1)):await this.eventPublisher.publish(new ve(u,t,s,l,i.mistakeCount+1))}return c}isGridComplete(e){console.log("Checking if grid is complete...");let t=0;for(let s=0;s<9;s++)for(let i=0;i<9;i++){if(e.getCell(new h(s,i)).isEmpty())return console.log(`Empty cell found at (${s}, ${i}), grid not complete`),!1;t++}console.log(`All ${t} cells are filled. Checking for conflicts...`);for(let s=0;s<9;s++){const i=new Set;for(let n=0;n<9;n++){const l=e.getCell(new h(s,n)).value.toString();if(i.has(l))return console.log(`Duplicate value ${l} in row ${s}`),!1;i.add(l)}}for(let s=0;s<9;s++){const i=new Set;for(let n=0;n<9;n++){const l=e.getCell(new h(n,s)).value.toString();if(i.has(l))return console.log(`Duplicate value ${l} in column ${s}`),!1;i.add(l)}}for(let s=0;s<3;s++)for(let i=0;i<3;i++){const n=new Set;for(let r=s*3;r<s*3+3;r++)for(let l=i*3;l<i*3+3;l++){const c=e.getCell(new h(r,l)).value.toString();if(n.has(c))return console.log(`Duplicate value ${c} in box (${s}, ${i})`),!1;n.add(c)}}return console.log("🎉 Grid is complete and valid!"),!0}validateCompleteGrid(e){const t=[],s=[],i=[];for(let n=0;n<9;n++)for(let r=0;r<9;r++){const l=new h(n,r),a=e.getCell(l);if(!a.isEmpty()){const c={grid:e,position:l,value:a.value,gameState:{isComplete:!1,isPaused:!1,mistakeCount:0}},u=this.moveValidationEngine.validate(c);u.isValid||(t.push(...u.violatedRules.map(d=>d.errorMessage)),s.push(...u.violatedRules.map(d=>d.rule.name)),i.push(...this.getConflictingPositions(e,l,a.value)))}}return{isValid:t.length===0,conflictingPositions:this.removeDuplicatePositions(i),errorMessages:[...new Set(t)],violatedRules:[...new Set(s)]}}getConflictingPositions(e,t,s){if(s.isEmpty())return[];const i=[];for(let l=0;l<9;l++)if(l!==t.col){const a=e.getCell(new h(t.row,l));!a.isEmpty()&&a.value.equals(s)&&i.push(new h(t.row,l))}for(let l=0;l<9;l++)if(l!==t.row){const a=e.getCell(new h(l,t.col));!a.isEmpty()&&a.value.equals(s)&&i.push(new h(l,t.col))}const n=Math.floor(t.row/3)*3,r=Math.floor(t.col/3)*3;for(let l=n;l<n+3;l++)for(let a=r;a<r+3;a++)if(l!==t.row||a!==t.col){const c=e.getCell(new h(l,a));!c.isEmpty()&&c.value.equals(s)&&i.push(new h(l,a))}return i}async generateSuggestions(e,t,s){const i=[],n=await this.getPossibleValues(e,t);if(n.length===1)i.push({type:"naked_single",position:t,value:new w(n[0]),reasoning:`Only ${n[0]} is possible in this cell`});else if(n.length>1){const r=this.getInvalidReasons(e,t,s);r.length>0&&i.push({type:"elimination",position:t,value:s,reasoning:`Cannot place ${s.value}: ${r.join(", ")}`})}for(const r of n)await this.isHiddenSingle(e,t,new w(r))&&i.push({type:"hidden_single",position:t,value:new w(r),reasoning:`${r} can only go in this position within its unit`});return i}async getPossibleValues(e,t){const s=[];for(let i=1;i<=9;i++){const n=new w(i),r={grid:e,position:t,value:n,gameState:{isComplete:!1,isPaused:!1,mistakeCount:0}},l=new q;l.addRules([new(await k(()=>Promise.resolve().then(()=>F),void 0)).UniqueInRowRule,new(await k(()=>Promise.resolve().then(()=>F),void 0)).UniqueInColumnRule,new(await k(()=>Promise.resolve().then(()=>F),void 0)).UniqueInBoxRule]),l.validate(r).isValid&&s.push(i)}return s}getInvalidReasons(e,t,s){const i=[];for(let l=0;l<9;l++)if(l!==t.col){const a=e.getCell(new h(t.row,l));if(!a.isEmpty()&&a.value.equals(s)){i.push(`conflicts with row ${t.row+1}`);break}}for(let l=0;l<9;l++)if(l!==t.row){const a=e.getCell(new h(l,t.col));if(!a.isEmpty()&&a.value.equals(s)){i.push(`conflicts with column ${t.col+1}`);break}}const n=Math.floor(t.row/3)*3,r=Math.floor(t.col/3)*3;for(let l=n;l<n+3;l++)for(let a=r;a<r+3;a++)if(l!==t.row||a!==t.col){const c=e.getCell(new h(l,a));if(!c.isEmpty()&&c.value.equals(s)){const u=Math.floor(t.row/3)*3+Math.floor(t.col/3)+1;i.push(`conflicts with box ${u}`);break}}return i}async isHiddenSingle(e,t,s){let i=0;for(let c=0;c<9;c++){const u=new h(t.row,c);await this.canPlaceValue(e,u,s)&&i++}if(i===1)return!0;let n=0;for(let c=0;c<9;c++){const u=new h(c,t.col);await this.canPlaceValue(e,u,s)&&n++}if(n===1)return!0;const r=Math.floor(t.row/3)*3,l=Math.floor(t.col/3)*3;let a=0;for(let c=r;c<r+3;c++)for(let u=l;u<l+3;u++){const d=new h(c,u);await this.canPlaceValue(e,d,s)&&a++}return a===1}async canPlaceValue(e,t,s){return e.getCell(t).isEmpty()?(await this.getPossibleValues(e,t)).includes(s.value||0):!1}removeDuplicatePositions(e){const t=[],s=new Set;for(const i of e){const n=`${i.row},${i.col}`;s.has(n)||(s.add(n),t.push(i))}return t}setDifficulty(e){this.moveValidationEngine=Y.createDifficultySpecificEngine(e)}setEventPublisher(e){this.eventPublisher=e}}class Ae{constructor(e,t,s){this.gameRepository=e,this.validationService=t,this.eventPublisher=s,this.lineCompletionDetectionService=new pe,this.enhancedValidationService=new Te(C.MEDIUM,this.eventPublisher)}async createNewGame(e){const t=this.generateGameId(),s=await this.generateSudokuGrid(e),i=p.create(t,e),n=R.create(t,s,i);return await this.gameRepository.save(n),this.eventPublisher&&await this.eventPublisher.publish(new Ee(t,e,{gridSize:9,clueCount:s.getFilledCellCount()})),n}async loadGame(e){return await this.gameRepository.load(e)}async saveGame(e){await this.gameRepository.save(e)}async deleteGame(e){await this.gameRepository.delete(e)}async makeMove(e,t,s){if(e.grid.getCell(t).isGiven)return this.createMoveResult(!1,e,!1,[],[]);const n=await this.enhancedValidationService.validateMove(e.grid,t,s,e.state),r=e.grid.setCell(t,s);let l=e.state.addMove();n.isValid||(l=l.addMistake());const a=e.updateGrid(r).updateState(l),c=this.enhancedValidationService.isGridComplete(r);console.log("Move validation result:",{position:t.toString(),value:s.toString(),isValid:n.isValid,isComplete:c,filledCells:r.getFilledCellCount(),totalCells:81});let u=[];if(n.isValid&&!s.isEmpty()){const P=this.lineCompletionDetectionService.detectCompletions(r,t);u=this.lineCompletionDetectionService.createEffectsFromCompletions(P,E.RADIAL)}const d=c?a.updateState(l.complete()):a;return c&&this.eventPublisher&&await this.eventPublisher.publish(new Se(e.state.gameId,e.state.difficulty,{elapsedTime:d.state.elapsedTime,moveCount:d.state.moveCount,mistakeCount:d.state.mistakeCount,hintsUsed:d.state.hintsUsed})),await this.saveGame(d),this.createMoveResult(!0,d,c,n.conflictingPositions,u)}createMoveResult(e,t,s,i,n){return{success:e,game:t,isComplete:s,conflictingPositions:i,lineCompletionEffects:n}}async getHint(e){const t=e.grid.getEmptyCells();if(t.length===0)return null;for(const n of t){const r=this.validationService.getPossibleValues(e.grid,n.position);if(r.length===1){const l=r[0],a=e.state.addHint(),c=e.updateState(a);return this.eventPublisher&&await this.eventPublisher.publish(new J(e.state.gameId,n.position,l,{hintsUsed:c.state.hintsUsed,hintType:"naked_single",reasoning:`Only ${l.value} is possible at this position`})),await this.saveGame(c),{success:!0,game:c,position:n.position,value:l}}}const s=t[Math.floor(Math.random()*t.length)],i=this.validationService.getPossibleValues(e.grid,s.position);if(i.length>0){const n=i[0],r=e.state.addHint(),l=e.updateState(r);return this.eventPublisher&&await this.eventPublisher.publish(new J(e.state.gameId,s.position,n,{hintsUsed:l.state.hintsUsed,hintType:"random",reasoning:`One of ${i.length} possible values`})),await this.saveGame(l),{success:!0,game:l,position:s.position,value:n}}return null}async selectCell(e,t){const s=e.state.selectCell(t.row,t.col),i=e.updateState(s);return await this.saveGame(i),i}async clearSelection(e){const t=e.state.clearSelection(),s=e.updateState(t);return await this.saveGame(s),s}async resetGame(e){const t=e.reset();return this.eventPublisher&&await this.eventPublisher.publish(new Ge(e.state.gameId,{previousStats:{moveCount:e.state.moveCount,mistakeCount:e.state.mistakeCount,hintsUsed:e.state.hintsUsed,elapsedTime:e.state.elapsedTime}})),await this.saveGame(t),t}async pauseGame(e){const t=e.state.pause(),s=e.updateState(t);return this.eventPublisher&&await this.eventPublisher.publish(new ye(e.state.gameId,{elapsedTime:s.state.elapsedTime,moveCount:s.state.moveCount})),await this.saveGame(s),s}async resumeGame(e){const t=e.state.resume(),s=e.updateState(t);return this.eventPublisher&&await this.eventPublisher.publish(new Ie(e.state.gameId,{elapsedTime:s.state.elapsedTime,moveCount:s.state.moveCount})),await this.saveGame(s),s}generateGameId(){return`game_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async generateSudokuGrid(e){console.log(`Generating new ${e} puzzle...`);const t=Date.now()+Math.random()*1e6,i=new me(t).generatePuzzle(e,{useSymmetricRemoval:e===C.EASY});return console.log(`Successfully generated ${e} puzzle with seed: ${t}`),i}}class Me{constructor(){this.STORAGE_PREFIX="sudoku_game_",this.STATE_PREFIX="sudoku_state_",this.GAMES_LIST_KEY="sudoku_games_list"}async save(e){const t=this.serializeGame(e),s=this.STORAGE_PREFIX+e.id;localStorage.setItem(s,JSON.stringify(t));const i=await this.getAllGameIds();i.includes(e.id)||(i.push(e.id),localStorage.setItem(this.GAMES_LIST_KEY,JSON.stringify(i)))}async load(e){const t=this.STORAGE_PREFIX+e,s=localStorage.getItem(t);if(!s)return null;try{const i=JSON.parse(s);return this.deserializeGame(i)}catch(i){return console.error("Failed to deserialize game:",i),null}}async delete(e){const t=this.STORAGE_PREFIX+e,s=this.STATE_PREFIX+e;localStorage.removeItem(t),localStorage.removeItem(s);const n=(await this.getAllGameIds()).filter(r=>r!==e);localStorage.setItem(this.GAMES_LIST_KEY,JSON.stringify(n))}async getAllGameIds(){const e=localStorage.getItem(this.GAMES_LIST_KEY);return e?JSON.parse(e):[]}async saveGameState(e,t){const s=this.STATE_PREFIX+e,i=this.serializeGameState(t);localStorage.setItem(s,JSON.stringify(i))}async loadGameState(e){const t=this.STATE_PREFIX+e,s=localStorage.getItem(t);if(!s)return null;try{const i=JSON.parse(s);return this.deserializeGameState(i)}catch(i){return console.error("Failed to deserialize game state:",i),null}}serializeGame(e){return{id:e.id,grid:this.serializeGrid(e.grid),initialGrid:this.serializeGrid(e.initialGrid),state:this.serializeGameState(e.state)}}serializeGrid(e){return Array.from({length:9},(t,s)=>Array.from({length:9},(i,n)=>{const r=e.getCell(new h(s,n));return{row:s,col:n,value:r.value.value,isGiven:r.isGiven,isHighlighted:r.isHighlighted,hasError:r.hasError}}))}serializeGameState(e){var t;return{id:e.id,difficulty:e.difficulty,status:e.status,statistics:{startTime:e.statistics.startTime.toISOString(),endTime:(t=e.statistics.endTime)==null?void 0:t.toISOString(),elapsedTime:e.statistics.elapsedTime,moves:e.statistics.moves,hints:e.statistics.hints,mistakes:e.statistics.mistakes},selectedCell:e.selectedCell}}deserializeGame(e){const t=this.deserializeGrid(e.grid),s=this.deserializeGrid(e.initialGrid),i=this.deserializeGameState(e.state);return new R(e.id,t,s,i)}deserializeGrid(e){const t=e.map(s=>s.map(i=>{const n=new h(i.row,i.col),r=i.value?w.from(i.value):w.empty();return new y(n,r,{isGiven:i.isGiven,isHighlighted:i.isHighlighted,hasError:i.hasError})}));return new N(t)}deserializeGameState(e){return new p(e.id,e.difficulty,e.status,{startTime:new Date(e.statistics.startTime),endTime:e.statistics.endTime?new Date(e.statistics.endTime):void 0,elapsedTime:e.statistics.elapsedTime,moves:e.statistics.moves,hints:e.statistics.hints,mistakes:e.statistics.mistakes},e.selectedCell)}}class Pe{constructor(e,t,s){this.ctx=e,this.cellSize=t,this.gridSize=s,this.borderWidth=.5,this.subGridBorderWidth=3,this.outerBorderWidth=3}render(e){this.drawBackground(e.backgroundColor),this.drawCellBorders(e.borderColor),this.drawSubGridBorders(e.subGridBorderColor),this.drawOuterBorder(e.subGridBorderColor)}updateDimensions(e,t){this.cellSize=e,this.gridSize=t}drawBackground(e){this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.gridSize,this.gridSize)}drawCellBorders(e){this.ctx.strokeStyle=e,this.ctx.lineWidth=this.borderWidth;for(let t=0;t<=9;t++)this.ctx.beginPath(),this.ctx.moveTo(t*this.cellSize,0),this.ctx.lineTo(t*this.cellSize,this.gridSize),this.ctx.stroke();for(let t=0;t<=9;t++)this.ctx.beginPath(),this.ctx.moveTo(0,t*this.cellSize),this.ctx.lineTo(this.gridSize,t*this.cellSize),this.ctx.stroke()}drawSubGridBorders(e){this.ctx.strokeStyle=e,this.ctx.lineWidth=this.subGridBorderWidth;for(let t=3;t<=6;t+=3)this.ctx.beginPath(),this.ctx.moveTo(t*this.cellSize,0),this.ctx.lineTo(t*this.cellSize,this.gridSize),this.ctx.stroke();for(let t=3;t<=6;t+=3)this.ctx.beginPath(),this.ctx.moveTo(0,t*this.cellSize),this.ctx.lineTo(this.gridSize,t*this.cellSize),this.ctx.stroke()}drawOuterBorder(e){this.ctx.strokeStyle=e,this.ctx.lineWidth=this.outerBorderWidth,this.ctx.beginPath(),this.ctx.rect(0,0,this.gridSize,this.gridSize),this.ctx.stroke()}}class Ne{constructor(e,t){this.ctx=e,this.cellSize=t,this.animationFrame=null,this.pulseTime=0}renderSelection(e,t,s){s.animationEnabled?this.renderAnimatedSelection(e,t,s):this.renderStaticSelection(e,t,s)}renderRelatedCells(e,t,s){this.highlightRow(e,t,s.relatedCellsEffect),this.highlightColumn(e,t,s.relatedCellsEffect)}renderNumberHighlights(e,t,s){const i=t.filter(n=>n.value===e);for(const n of i)this.highlightNumber(n.row,n.col,s.numberHighlightEffect)}updateDimensions(e){this.cellSize=e}startAnimation(){this.pulseTime=Date.now()}stopAnimation(){this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null)}renderStaticSelection(e,t,s){const i=t*this.cellSize,n=e*this.cellSize;switch(s.selectedCellEffect.type){case"border":this.drawSelectionBorder(i,n,s.selectedCellEffect);break;case"highlight":this.drawSelectionHighlight(i,n,s.selectedCellEffect);break;case"glow":this.drawSelectionGlow(i,n,s.selectedCellEffect);break}}renderAnimatedSelection(e,t,s){const i=t*this.cellSize,n=e*this.cellSize;s.selectedCellEffect.type==="pulse"?this.drawPulsingSelection(i,n,s.selectedCellEffect):this.renderStaticSelection(e,t,s)}drawSelectionBorder(e,t,s){this.ctx.strokeStyle=s.color,this.ctx.lineWidth=3+s.intensity,this.ctx.globalAlpha=s.opacity,this.ctx.strokeRect(e+2,t+2,this.cellSize-4,this.cellSize-4),this.ctx.globalAlpha=1}drawSelectionHighlight(e,t,s){this.ctx.fillStyle=s.color,this.ctx.globalAlpha=s.opacity,this.ctx.fillRect(e+1,t+1,this.cellSize-2,this.cellSize-2),this.ctx.globalAlpha=1}drawSelectionGlow(e,t,s){const i=this.ctx.createRadialGradient(e+this.cellSize/2,t+this.cellSize/2,0,e+this.cellSize/2,t+this.cellSize/2,this.cellSize/2+s.intensity);i.addColorStop(0,s.color),i.addColorStop(1,"transparent"),this.ctx.fillStyle=i,this.ctx.globalAlpha=s.opacity,this.ctx.fillRect(e-s.intensity,t-s.intensity,this.cellSize+2*s.intensity,this.cellSize+2*s.intensity),this.ctx.globalAlpha=1}drawPulsingSelection(e,t,s){const i=(Date.now()-this.pulseTime)/1e3,n=(Math.sin(i*3)+1)/2,r=s.opacity*(.3+n*.7),l=s.intensity*(.8+n*.4),a={...s,opacity:r,intensity:l};this.drawSelectionBorder(e,t,a)}highlightRow(e,t,s){this.ctx.fillStyle=s.color,this.ctx.globalAlpha=s.opacity;for(let i=0;i<9;i++)if(i!==t){const n=i*this.cellSize,r=e*this.cellSize;this.ctx.fillRect(n+1,r+1,this.cellSize-2,this.cellSize-2)}this.ctx.globalAlpha=1}highlightColumn(e,t,s){this.ctx.fillStyle=s.color,this.ctx.globalAlpha=s.opacity;for(let i=0;i<9;i++)if(i!==e){const n=t*this.cellSize,r=i*this.cellSize;this.ctx.fillRect(n+1,r+1,this.cellSize-2,this.cellSize-2)}this.ctx.globalAlpha=1}highlightNumber(e,t,s){const i=t*this.cellSize,n=e*this.cellSize;switch(s.type){case"highlight":this.drawNumberHighlight(i,n,s);break;case"glow":this.drawNumberGlow(i,n,s);break;case"border":this.drawNumberBorder(i,n,s);break}}drawNumberHighlight(e,t,s){this.ctx.fillStyle=s.color,this.ctx.globalAlpha=s.opacity,this.ctx.fillRect(e+2,t+2,this.cellSize-4,this.cellSize-4),this.ctx.globalAlpha=1}drawNumberGlow(e,t,s){const i=this.ctx.createRadialGradient(e+this.cellSize/2,t+this.cellSize/2,this.cellSize*.1,e+this.cellSize/2,t+this.cellSize/2,this.cellSize*.4);i.addColorStop(0,s.color),i.addColorStop(1,"transparent"),this.ctx.fillStyle=i,this.ctx.globalAlpha=s.opacity,this.ctx.fillRect(e,t,this.cellSize,this.cellSize),this.ctx.globalAlpha=1}drawNumberBorder(e,t,s){this.ctx.strokeStyle=s.color,this.ctx.lineWidth=2,this.ctx.globalAlpha=s.opacity,this.ctx.strokeRect(e+3,t+3,this.cellSize-6,this.cellSize-6),this.ctx.globalAlpha=1}}class Le{constructor(e,t){this.ctx=e,this.cellSize=t}updateDimensions(e){this.cellSize=e}renderEffects(e,t){e.forEach(s=>{s.isPlaying()&&this.renderEffect(s,t)})}renderEffect(e,t){e.getActiveCellEffects().forEach(i=>{this.renderCellEffect(i,e,t)})}renderCellEffect(e,t,s){const i=t.getCellEffectProgress(e.position);if(!i)return;const n=e.position.col*this.cellSize,r=e.position.row*this.cellSize;this.renderScalingEffect(n,r,i.scale,i.opacity,s)}renderScalingEffect(e,t,s,i,n){const r=e+this.cellSize/2,l=t+this.cellSize/2,a=this.cellSize*s,c=r-a/2,u=l-a/2;this.ctx.save(),this.ctx.globalAlpha=i*.7;const d=n.theme==="dark"?"100, 150, 255":"50, 120, 255",P=this.ctx.createRadialGradient(r,l,0,r,l,a/2);P.addColorStop(0,`rgba(${d}, ${i})`),P.addColorStop(.7,`rgba(${d}, ${i*.6})`),P.addColorStop(1,`rgba(${d}, 0)`),this.ctx.fillStyle=P,this.ctx.fillRect(c,u,a,a),this.ctx.strokeStyle=`rgba(${d}, ${i*.8})`,this.ctx.lineWidth=Math.max(1,s*2),this.ctx.strokeRect(c,u,a,a),this.ctx.shadowColor=`rgba(${d}, ${i})`,this.ctx.shadowBlur=s*5,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.strokeRect(c+2,u+2,a-4,a-4),this.ctx.restore()}hasActiveEffects(e){return e.some(t=>t.isPlaying())}updateEffects(e,t){return e.map(s=>s.updateProgress(t)).filter(s=>!s.isCompleted())}}class W{constructor(e,t={highlightErrors:!0,showPossibleValues:!1,theme:"light"}){this.canvas=e,this.defaultOptions=t,this.cellSize=0,this.gridSize=0,this.activeEffects=[];const s=e.getContext("2d");if(!s)throw new Error("Could not get canvas 2D context");this.ctx=s,this.calculateDimensions(),this.boardRenderer=new Pe(this.ctx,this.cellSize,this.gridSize),this.selectionRenderer=new Ne(this.ctx,this.cellSize),this.effectsRenderer=new Le(this.ctx,this.cellSize)}render(e,t={}){const s={...this.defaultOptions,...t};this.updateEffects(),this.clear(),this.renderBoard(s),this.renderCells(e,s),this.renderEffects(s),this.renderSelection(e,s)}getPositionFromCoords(e,t){console.log("Canvas dimensions:",this.canvas.width,this.canvas.height),console.log("Cell size:",this.cellSize),console.log("Input coordinates:",e,t);const s=Math.floor(e/this.cellSize),i=Math.floor(t/this.cellSize);if(console.log("Calculated row/col:",i,s),i>=0&&i<9&&s>=0&&s<9)try{return new h(i,s)}catch(n){return console.error("Position creation error:",n),null}return console.log("Position out of bounds"),null}resize(e,t){this.canvas.width=e,this.canvas.height=t,this.calculateDimensions(),this.boardRenderer.updateDimensions(this.cellSize,this.gridSize),this.selectionRenderer.updateDimensions(this.cellSize),this.effectsRenderer.updateDimensions(this.cellSize)}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}calculateDimensions(){this.gridSize=Math.min(this.canvas.width,this.canvas.height),this.cellSize=this.gridSize/9,console.log("Canvas dimensions calculated:",{canvasWidth:this.canvas.width,canvasHeight:this.canvas.height,gridSize:this.gridSize,cellSize:this.cellSize})}renderBoard(e){const t={theme:e.theme,borderColor:e.theme==="dark"?"#555555":"#e0e0e0",subGridBorderColor:e.theme==="dark"?"#ffffff":"#333333",backgroundColor:e.theme==="dark"?"#2a2a2a":"#ffffff"};this.boardRenderer.render(t)}renderCells(e,t){const s=this.getSelectedCellValue(e);for(let i=0;i<9;i++)for(let n=0;n<9;n++){const r=new h(i,n),l=e.grid.getCell(r),a=s!==null&&!l.isEmpty()&&l.value.value===s;this.renderCell(l,t,a)}}getSelectedCellValue(e){if(!e.state.selectedCell)return null;const{row:t,col:s}=e.state.selectedCell,i=e.grid.getCell(new h(t,s));return i.isEmpty()?null:i.value.value}renderCell(e,t,s=!1){const i=e.position.col*this.cellSize,n=e.position.row*this.cellSize;this.renderCellBackground(i,n,e,t),e.isEmpty()||this.renderCellValue(i,n,e,t,s)}renderCellBackground(e,t,s,i){let n=i.theme==="dark"?"#2a2a2a":"#ffffff";s.isGiven?n=i.theme==="dark"?"#3a3a3a":"#f0f0f0":s.hasError&&i.highlightErrors&&(n=i.theme==="dark"?"#4a2222":"#ffe6e6"),this.ctx.fillStyle=n,this.ctx.fillRect(e+1,t+1,this.cellSize-2,this.cellSize-2)}renderCellValue(e,t,s,i,n=!1){this.ctx.font=`${Math.floor(this.cellSize*.6)}px Arial`,this.ctx.textAlign="center",this.ctx.textBaseline="middle";let r=i.theme==="dark"?"#ffffff":"#000000";s.isGiven?r=i.theme==="dark"?"#cccccc":"#333333":s.hasError&&i.highlightErrors&&(r=i.theme==="dark"?"#ff6666":"#cc0000"),n&&(r=i.theme==="dark"?"#40E0D0":"#FF8C00",this.ctx.font=`bold ${Math.floor(this.cellSize*.6)}px Arial`,this.ctx.shadowColor=r,this.ctx.shadowBlur=8,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0),this.ctx.fillStyle=r,this.ctx.fillText(s.value.toString(),e+this.cellSize/2,t+this.cellSize/2),n&&(this.ctx.shadowBlur=0)}renderSelection(e,t){if(!e.state.selectedCell)return;const{row:s,col:i}=e.state.selectedCell,n=e.grid.getCell(new h(s,i)),r={selectedCellEffect:{type:"border",color:t.theme==="dark"?"#4da6ff":"#007bff",opacity:.8,intensity:2},relatedCellsEffect:{type:"highlight",color:t.theme==="dark"?"rgba(77, 166, 255, 0.2)":"rgba(0, 123, 255, 0.15)",opacity:.4,intensity:0},numberHighlightEffect:{type:"highlight",color:t.theme==="dark"?"rgba(64, 224, 208, 0.15)":"rgba(255, 140, 0, 0.2)",opacity:.5,intensity:1},animationEnabled:!0,theme:t.theme};if(this.selectionRenderer.renderRelatedCells(s,i,r),!n.isEmpty()){const l=n.value.value,a=this.getAllCellsWithNumbers(e);this.selectionRenderer.renderNumberHighlights(l,a,r)}this.selectionRenderer.renderSelection(s,i,r)}getAllCellsWithNumbers(e){const t=[];for(let s=0;s<9;s++)for(let i=0;i<9;i++){const n=new h(s,i),r=e.grid.getCell(n);r.isEmpty()||t.push({row:s,col:i,value:r.value.value})}return t}addEffects(e){const t=e.map(s=>s.start());this.activeEffects.push(...t)}hasActiveEffects(){return this.effectsRenderer.hasActiveEffects(this.activeEffects)}updateEffects(){const e=Date.now();this.activeEffects=this.effectsRenderer.updateEffects(this.activeEffects,e)}renderEffects(e){if(this.activeEffects.length===0)return;const t={theme:e.theme,highlightColor:e.theme==="dark"?"rgba(255, 215, 0, 0.2)":"rgba(255, 140, 0, 0.25)",glowColor:e.theme==="dark"?"#FFD700":"#FF8C00",animationDuration:1500};this.effectsRenderer.renderEffects(this.activeEffects,t)}}class xe{constructor(e,t,s){this.gameService=e,this.renderer=t,this.events=s,this.currentGame=null,this.animationFrameId=null}async newGame(e){try{this.currentGame=await this.gameService.createNewGame(e),this.renderGame(),this.events.onGameUpdate(this.currentGame)}catch(t){this.events.onError(`Failed to create new game: ${t}`)}}async loadGame(e){try{const t=await this.gameService.loadGame(e);t?(this.currentGame=t,this.renderGame(),this.events.onGameUpdate(this.currentGame)):this.events.onError("Game not found")}catch(t){this.events.onError(`Failed to load game: ${t}`)}}async handleCellClick(e,t){if(console.log("GameController.handleCellClick called with:",e,t),!this.currentGame){console.log("No current game");return}const s=this.renderer.getPositionFromCoords(e,t);if(console.log("Position from coords:",s),!s){console.log("Invalid position");return}try{this.currentGame=await this.gameService.selectCell(this.currentGame,s),console.log("Cell selected successfully, selected cell:",this.currentGame.state.selectedCell),this.renderGame(),this.events.onGameUpdate(this.currentGame)}catch(i){console.error("Error selecting cell:",i),this.events.onError(`셀 선택에 실패했습니다: ${i}`)}}async handleNumberInput(e){var t;if(!((t=this.currentGame)!=null&&t.state.selectedCell)){this.events.onError("셀을 먼저 선택해주세요");return}try{const{row:s,col:i}=this.currentGame.state.selectedCell,n=await this.gameService.makeMove(this.currentGame,new h(s,i),w.from(e));this.currentGame=n.game,n.lineCompletionEffects&&n.lineCompletionEffects.length>0?this.handleLineCompletionEffects(n.lineCompletionEffects):this.renderGame(),this.events.onGameUpdate(this.currentGame),console.log("Game completion check:",{isComplete:n.isComplete,success:n.success,filledCells:this.getFilledCellsCount(),totalCells:81}),n.isComplete?(console.log("🎉 Game completed! Calling onGameComplete..."),this.events.onGameComplete(this.currentGame)):n.success||this.events.onError("잘못된 입력입니다")}catch(s){this.events.onError(`Failed to make move: ${s}`)}}async handleClearCell(){if(this.currentGame){if(!this.currentGame.state.selectedCell){this.events.onError("셀을 먼저 선택해주세요");return}try{const{row:e,col:t}=this.currentGame.state.selectedCell,s=new h(e,t),i=await this.gameService.makeMove(this.currentGame,s,w.empty());this.currentGame=i.game,i.lineCompletionEffects&&i.lineCompletionEffects.length>0?this.handleLineCompletionEffects(i.lineCompletionEffects):this.renderGame(),this.events.onGameUpdate(this.currentGame)}catch(e){this.events.onError(`Failed to clear cell: ${e}`)}}}async handleHint(){if(this.currentGame)try{const e=await this.gameService.getHint(this.currentGame);if(e){this.currentGame=e.game;const t=await this.gameService.makeMove(this.currentGame,e.position,e.value);this.currentGame=t.game,t.lineCompletionEffects&&t.lineCompletionEffects.length>0?this.handleLineCompletionEffects(t.lineCompletionEffects):this.renderGame(),this.events.onGameUpdate(this.currentGame),t.isComplete&&this.events.onGameComplete(this.currentGame)}else this.events.onError("No hints available")}catch(e){this.events.onError(`Failed to get hint: ${e}`)}}async handleReset(){if(this.currentGame)try{this.currentGame=await this.gameService.resetGame(this.currentGame),this.renderGame(),this.events.onGameUpdate(this.currentGame)}catch(e){this.events.onError(`Failed to reset game: ${e}`)}}async handlePause(){if(this.currentGame)try{this.currentGame=await this.gameService.pauseGame(this.currentGame),this.renderGame(),this.events.onGameUpdate(this.currentGame)}catch(e){this.events.onError(`Failed to pause game: ${e}`)}}async handleResume(){if(this.currentGame)try{this.currentGame=await this.gameService.resumeGame(this.currentGame),this.renderGame(),this.events.onGameUpdate(this.currentGame)}catch(e){this.events.onError(`Failed to resume game: ${e}`)}}getCurrentGame(){return this.currentGame}getFilledCellsCount(){if(!this.currentGame)return 0;let e=0;for(let t=0;t<9;t++)for(let s=0;s<9;s++){const i=new h(t,s);this.currentGame.grid.getCell(i).isEmpty()||e++}return e}renderGame(){this.currentGame&&this.renderer.render(this.currentGame,{highlightErrors:!0,showPossibleValues:!1,theme:"light"})}handleLineCompletionEffects(e){this.renderer instanceof W?(this.renderer.addEffects(e),this.startEffectAnimation()):this.renderGame()}startEffectAnimation(){this.animationFrameId!==null&&cancelAnimationFrame(this.animationFrameId);let e=0;const s=1e3/60,i=n=>{n-e>=s&&(this.renderGame(),e=n),this.renderer instanceof W&&this.renderer.hasActiveEffects()?this.animationFrameId=requestAnimationFrame(i):this.animationFrameId=null};this.animationFrameId=requestAnimationFrame(i)}destroy(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}}class De{constructor(){this.elementCache=new Map}getElement(e){if(!this.elementCache.has(e)){const t=document.getElementById(e);if(!t)throw new Error(`Element not found: ${e}`);this.elementCache.set(e,t)}return this.elementCache.get(e)}getElements(e){return document.querySelectorAll(e)}updateTextContent(e,t){const s=this.getElement(e);s.textContent=t}updateStyle(e,t,s){const i=this.getElement(e);i.style[t]=s}updateStyles(e,t){const s=this.getElement(e);Object.entries(t).forEach(([i,n])=>{n!==void 0&&(s.style[i]=n)})}elementExists(e){try{return this.getElement(e),!0}catch{return!1}}hasElement(e){return document.getElementById(e)!==null}clearCache(){this.elementCache.clear()}removeFromCache(e){this.elementCache.delete(e)}}const f={CANVAS:"gameCanvas",TIMER:"timer",COMPLETION:"completion",HINTS:"hints",SELECTION_INFO:"selectionInfo",NEW_GAME_BTN:"newGame",RESET_GAME_BTN:"resetGame",HINT_BTN:"hintButton",CLEAR_CELL_BTN:"clearCell",NUMBER_BTNS:".number-btn"};class _e{constructor(e,t){this.domManager=t;const s=this.domManager.getElement(f.CANVAS);this.canvasEventHandler=new ke(s,e),this.keyboardEventHandler=new Oe(e),this.buttonEventHandler=new ze(e,this.domManager)}setupEventListeners(){this.canvasEventHandler.attachEvents(),this.keyboardEventHandler.attachEvents(),this.buttonEventHandler.attachEvents()}removeEventListeners(){this.canvasEventHandler.detachEvents(),this.keyboardEventHandler.detachEvents(),this.buttonEventHandler.detachEvents()}}class ke{constructor(e,t){this.canvas=e,this.gameController=t,this.handleCanvasClick=s=>{const{x:i,y:n}=this.calculateCanvasCoordinates(s);console.log("Click event:",{clientX:s.clientX,clientY:s.clientY,rect:this.canvas.getBoundingClientRect(),canvas:{width:this.canvas.width,height:this.canvas.height},calculated:{x:i,y:n}}),setTimeout(()=>{this.gameController.handleCellClick(i,n)},0)}}calculateCanvasCoordinates(e){const t=this.canvas.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*this.canvas.width,y:(e.clientY-t.top)/t.height*this.canvas.height}}attachEvents(){this.canvas.addEventListener("click",this.handleCanvasClick)}detachEvents(){this.canvas.removeEventListener("click",this.handleCanvasClick)}}class Oe{constructor(e){this.gameController=e,this.handleKeyDown=t=>{this.isNumberKey(t.key)?setTimeout(()=>{this.gameController.handleNumberInput(parseInt(t.key))},0):this.isClearKey(t.key)&&setTimeout(()=>{this.gameController.handleClearCell()},0)}}isNumberKey(e){return e>="1"&&e<="9"}isClearKey(e){return e==="Delete"||e==="Backspace"}attachEvents(){document.addEventListener("keydown",this.handleKeyDown)}detachEvents(){document.removeEventListener("keydown",this.handleKeyDown)}}class ze{constructor(e,t){this.gameController=e,this.domManager=t,this.eventHandlers=new Map,this.handleNumberButtonClick=s=>{const i=s.target,n=parseInt(i.dataset.number||"0");n>=1&&n<=9&&setTimeout(()=>{this.gameController.handleNumberInput(n)},0)},this.setupEventHandlers()}setupEventHandlers(){this.eventHandlers.set(f.NEW_GAME_BTN,()=>{setTimeout(()=>this.handleNewGame(),0)}),this.eventHandlers.set(f.RESET_GAME_BTN,()=>{setTimeout(()=>this.gameController.handleReset(),0)}),this.eventHandlers.set(f.HINT_BTN,()=>{setTimeout(()=>this.gameController.handleHint(),0)}),this.eventHandlers.set(f.CLEAR_CELL_BTN,()=>{setTimeout(()=>this.gameController.handleClearCell(),0)})}async handleNewGame(){const{Difficulty:e}=await k(()=>Promise.resolve().then(()=>ee),void 0);await this.gameController.newGame(e.EASY)}attachEvents(){this.eventHandlers.forEach((t,s)=>{this.domManager.getElement(s).addEventListener("click",t)}),this.domManager.getElements(f.NUMBER_BTNS).forEach(t=>{t.addEventListener("click",this.handleNumberButtonClick)})}detachEvents(){this.eventHandlers.forEach((t,s)=>{this.domManager.elementExists(s)&&this.domManager.getElement(s).removeEventListener("click",t)}),this.domManager.getElements(f.NUMBER_BTNS).forEach(t=>{t.removeEventListener("click",this.handleNumberButtonClick)})}}const G={TIMER:{INITIAL_DELAY:100,RESIZE_DELAY:100,ORIENTATION_CHANGE_DELAY:200},GAME:{GRID_SIZE:9,TOTAL_CELLS:81,DEFAULT_DIFFICULTY:"EASY"},UI:{MESSAGE_DURATION:3e3,GAME_COMPLETE_DELAY:1e3,CANVAS_ASPECT_RATIO:1}},T={ERROR:"#dc3545",INFO:"#6c757d",SUCCESS:"#28a745",PRIMARY:"#007bff",MUTED:"#6c757d"},S={GAME_COMPLETE:"🎉 축하합니다! 퍼즐을 완성했습니다!",SELECT_CELL:"칸을 선택하고 숫자를 입력하세요",CELL_FIXED:"고정된 숫자입니다",INPUT_NUMBER:"숫자를 입력하세요",CELL_SELECTED:(o,e)=>`선택된 셀: (${o+1}, ${e+1})`,CELL_VALUE:(o,e,t)=>`셀 (${o+1}, ${e+1}): ${t}`,GAME_STATS:(o,e,t)=>`완료 시간: ${o}
움직임: ${e}
힌트: ${t}`};class Be{constructor(e){this.domManager=e}updateGameInfo(e,t){const s=e.state.statistics,i=this.getFilledCellsCount(e),n=[{elementId:f.COMPLETION,content:`${i}/${G.GAME.TOTAL_CELLS}`},{elementId:f.HINTS,content:s.hints.toString()}];t&&n.push({elementId:f.TIMER,content:t}),this.batchUpdate(n)}updateSelectionInfo(e){const t=e.state.selectedCell;let s,i;if(!t)s=S.SELECT_CELL,i=T.INFO;else{const{row:n,col:r}=t,l=e.grid.getCell(new h(n,r));l.isGiven?(s=`${S.CELL_SELECTED(n,r)} - ${S.CELL_FIXED}`,i=T.MUTED):l.isEmpty()?(s=`${S.CELL_SELECTED(n,r)} - ${S.INPUT_NUMBER}`,i=T.SUCCESS):(s=S.CELL_VALUE(n,r,l.value.toString()),i=T.PRIMARY)}this.batchUpdate([{elementId:f.SELECTION_INFO,content:s,style:{color:i}}])}showMessage(e,t="INFO",s=0){const i=T[t];this.batchUpdate([{elementId:f.SELECTION_INFO,content:e,style:{color:i}}]),s>0&&setTimeout(()=>{this.batchUpdate([{elementId:f.SELECTION_INFO,content:S.SELECT_CELL,style:{color:T.INFO}}])},s)}showGameComplete(e,t){console.log("UIManager.showGameComplete called!",{finalTime:t,gameStats:e.state.statistics});const s=e.state.statistics,i=`${S.GAME_COMPLETE}

${S.GAME_STATS(t,s.moves,s.hints)}`;console.log("About to show alert with message:",i),setTimeout(()=>{console.log("Showing game complete alert now!"),alert(i)},G.UI.GAME_COMPLETE_DELAY)}batchUpdate(e){e.forEach(t=>{try{this.domManager.updateTextContent(t.elementId,t.content),t.style&&this.domManager.updateStyles(t.elementId,t.style)}catch(s){console.warn(`Failed to update element ${t.elementId}:`,s)}})}getFilledCellsCount(e){let t=0;for(let s=0;s<G.GAME.GRID_SIZE;s++)for(let i=0;i<G.GAME.GRID_SIZE;i++){const n=new h(s,i);e.grid.getCell(n).isEmpty()||t++}return t}updateTimer(e){this.domManager.updateTextContent(f.TIMER,e)}updateNumberButtons(e){const t=e.grid.getRemainingCounts();for(let s=1;s<=9;s++){const i=t.get(s)||0,n=`[data-number="${s}"]`,r=`[data-number="${s}"] .number-count`;try{const l=document.querySelector(r);l&&(l.textContent=i.toString());const a=document.querySelector(n);a&&(i===0?(a.disabled=!0,a.setAttribute("aria-disabled","true")):(a.disabled=!1,a.removeAttribute("aria-disabled")))}catch(l){console.warn(`Failed to update number button ${s}:`,l)}}}resetUI(){this.batchUpdate([{elementId:f.TIMER,content:"00:00"},{elementId:f.COMPLETION,content:`0/${G.GAME.TOTAL_CELLS}`},{elementId:f.HINTS,content:"0"},{elementId:f.SELECTION_INFO,content:S.SELECT_CELL,style:{color:T.INFO}}]);for(let e=1;e<=9;e++){const t=`[data-number="${e}"]`,s=`[data-number="${e}"] .number-count`;try{const i=document.querySelector(s);i&&(i.textContent="9");const n=document.querySelector(t);n&&(n.disabled=!1,n.removeAttribute("aria-disabled"))}catch(i){console.warn(`Failed to reset number button ${e}:`,i)}}}}function U(o){const e=Math.floor(o/60),t=o%60;return`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`}class Ve{constructor(e){this.onTimeUpdate=e,this.animationFrameId=null,this.startTime=null,this.lastDisplayedSeconds=-1,this.tick=()=>{const t=this.getElapsedSeconds();if(t!==this.lastDisplayedSeconds){const s=U(t);this.onTimeUpdate(s),this.lastDisplayedSeconds=t}this.animationFrameId=requestAnimationFrame(this.tick)}}start(e){this.isRunning()&&this.startTime&&this.startTime.getTime()===e.state.statistics.startTime.getTime()||(this.stop(),this.startTime=e.state.statistics.startTime,this.lastDisplayedSeconds=-1,this.tick())}stop(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}getElapsedSeconds(){return this.startTime?Math.floor((Date.now()-this.startTime.getTime())/1e3):0}getFormattedElapsedTime(){return U(this.getElapsedSeconds())}isRunning(){return this.animationFrameId!==null}destroy(){this.stop(),this.startTime=null}reset(){this.stop(),this.startTime=null,this.lastDisplayedSeconds=-1,this.onTimeUpdate(U(0))}}class $e{constructor(){this.initializeDependencies(),this.setupManagers(),this.setupCanvas(),this.startNewGame()}initializeDependencies(){const e=new Me,t=new ie,s=new Ae(e,t);if(this.canvas=document.getElementById(f.CANVAS),!this.canvas)throw new Error("Canvas element not found");this.renderer=new W(this.canvas),this.gameController=new xe(s,this.renderer,{onGameUpdate:i=>this.handleGameUpdate(i),onGameComplete:i=>this.handleGameComplete(i),onError:i=>this.handleError(i)})}setupManagers(){this.domManager=new De,this.timerManager=new Ve(e=>{this.uiManager.updateTimer(e)}),this.uiManager=new Be(this.domManager),this.eventManager=new _e(this.gameController,this.domManager),this.eventManager.setupEventListeners()}setupCanvas(){this.setupResponsiveCanvas()}async startNewGame(){const{Difficulty:e}=await k(()=>Promise.resolve().then(()=>ee),void 0);await this.gameController.newGame(e.EASY)}handleGameUpdate(e){this.uiManager.updateGameInfo(e),this.uiManager.updateSelectionInfo(e),this.uiManager.updateNumberButtons(e),this.timerManager.start(e)}handleGameComplete(e){console.log("🎉 handleGameComplete called!",{gameId:e.state.gameId,isComplete:e.state.isComplete,statistics:e.state.statistics}),this.timerManager.stop();const t=this.timerManager.getFormattedElapsedTime();console.log("Final time and stats:",{finalTime:t,moves:e.state.statistics.moves,hints:e.state.statistics.hints}),this.uiManager.updateGameInfo(e,t),this.uiManager.showGameComplete(e,t)}handleError(e){this.uiManager.showMessage(e,"ERROR",G.UI.MESSAGE_DURATION)}setupResponsiveCanvas(){const e=()=>{const t=this.canvas.getBoundingClientRect(),s=Math.min(t.width,t.height),i=window.devicePixelRatio||1,n=Math.floor(s*i);console.log("Responsive canvas resize:",{cssSize:{width:t.width,height:t.height},canvasSize:s,devicePixelRatio:i,internalSize:n,timestamp:new Date().toISOString()}),this.canvas.width=n,this.canvas.height=n,this.renderer.resize(n,n);const r=this.gameController.getCurrentGame();r&&this.renderer.render(r,{highlightErrors:!0,showPossibleValues:!1,theme:"light"})};setTimeout(e,G.TIMER.INITIAL_DELAY),window.addEventListener("resize",()=>{setTimeout(e,G.TIMER.RESIZE_DELAY)}),window.addEventListener("orientationchange",()=>{setTimeout(e,G.TIMER.ORIENTATION_CHANGE_DELAY)})}destroy(){this.eventManager.removeEventListeners(),this.timerManager.destroy(),this.domManager.clearCache()}}document.addEventListener("DOMContentLoaded",()=>{try{new $e}catch(o){console.error("Failed to initialize Sudoku app:",o)}});
//# sourceMappingURL=index-65a6690b.js.map
